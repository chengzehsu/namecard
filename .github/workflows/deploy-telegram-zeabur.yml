name: Telegram Bot - Zeabur 自動部署

on:
  push:
    branches: [main]
    paths:
      - 'main.py'
      - 'telegram_main.py'
      - 'telegram_app.py'
      - 'telegram_bot_handler.py'
      - 'requirements-telegram.txt'
      - 'zeabur.json'
      - '.github/workflows/deploy-telegram-zeabur.yml'
  workflow_dispatch:

jobs:
  deploy:
    name: 🚀 自動部署 Telegram Bot
    runs-on: ubuntu-latest
    
    steps:
    - name: 🔄 檢出代碼
      uses: actions/checkout@v4
    
    - name: 📝 部署信息
      run: |
        echo "🚀 Telegram Bot 自動部署到 Zeabur"
        echo "📅 部署時間: $(date)"
        echo "🌿 分支: ${{ github.ref_name }}"
        echo "📝 提交: ${{ github.sha }}"
        echo "👤 觸發者: ${{ github.actor }}"
        echo ""
        echo "✅ GitHub App 已設置，Zeabur 會自動檢測並部署"
        echo "🔍 請前往 Zeabur Dashboard 查看部署狀態"
        echo "   👉 https://dash.zeabur.com/"
    
    - name: 🧪 部署配置檢查
      run: |
        echo ""
        echo "📋 檢查部署配置文件..."
        
        # 檢查關鍵文件
        files=("main.py" "telegram_main.py" "telegram_app.py" "requirements-telegram.txt" "zeabur.json")
        for file in "${files[@]}"; do
          if [[ -f "$file" ]]; then
            echo "✅ $file 存在"
          else
            echo "❌ $file 缺失"
          fi
        done
        
        echo ""
        echo "📦 檢查 zeabur.json 配置..."
        if [[ -f "zeabur.json" ]]; then
          cat zeabur.json
        fi
    
    - name: 📱 部署後提醒
      run: |
        echo ""
        echo "🎯 部署完成後的下一步："
        echo ""
        echo "1️⃣ 前往 Zeabur Dashboard 查看部署狀態"
        echo "   https://dash.zeabur.com/"
        echo ""
        echo "2️⃣ 獲取部署 URL（通常格式如下）"
        echo "   https://namecard-app.zeabur.app"
        echo "   或"
        echo "   https://your-service-name.zeabur.app"
        echo ""
        echo "3️⃣ 設置 Telegram Bot Webhook"
        echo "   curl -X POST \"https://api.telegram.org/bot\$TELEGRAM_BOT_TOKEN/setWebhook\" \\"
        echo "        -d \"url=https://your-app.zeabur.app/telegram-webhook\""
        echo ""
        echo "4️⃣ 測試應用健康狀態"
        echo "   curl https://your-app.zeabur.app/health"
        echo ""
        echo "5️⃣ 測試 Telegram Bot"
        echo "   在 Telegram 中發送 /start 給您的 Bot"