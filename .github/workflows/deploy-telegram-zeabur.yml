name: Telegram Bot - Zeabur è‡ªå‹•éƒ¨ç½²

on:
  push:
    branches: [main]
    paths:
      - 'main.py'
      - 'telegram_main.py'
      - 'telegram_app.py'
      - 'telegram_bot_handler.py'
      - 'requirements-telegram.txt'
      - 'zeabur.json'
      - '.github/workflows/deploy-telegram-zeabur.yml'
  workflow_dispatch:

jobs:
  deploy:
    name: ğŸš€ è‡ªå‹•éƒ¨ç½² Telegram Bot
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ”„ æª¢å‡ºä»£ç¢¼
      uses: actions/checkout@v4
    
    - name: ğŸ“ éƒ¨ç½²ä¿¡æ¯
      run: |
        echo "ğŸš€ Telegram Bot è‡ªå‹•éƒ¨ç½²åˆ° Zeabur"
        echo "ğŸ“… éƒ¨ç½²æ™‚é–“: $(date)"
        echo "ğŸŒ¿ åˆ†æ”¯: ${{ github.ref_name }}"
        echo "ğŸ“ æäº¤: ${{ github.sha }}"
        echo "ğŸ‘¤ è§¸ç™¼è€…: ${{ github.actor }}"
        echo ""
        echo "âœ… GitHub App å·²è¨­ç½®ï¼ŒZeabur æœƒè‡ªå‹•æª¢æ¸¬ä¸¦éƒ¨ç½²"
        echo "ğŸ” è«‹å‰å¾€ Zeabur Dashboard æŸ¥çœ‹éƒ¨ç½²ç‹€æ…‹"
        echo "   ğŸ‘‰ https://dash.zeabur.com/"
    
    - name: ğŸ§ª éƒ¨ç½²é…ç½®æª¢æŸ¥
      run: |
        echo ""
        echo "ğŸ“‹ æª¢æŸ¥éƒ¨ç½²é…ç½®æ–‡ä»¶..."
        
        # æª¢æŸ¥é—œéµæ–‡ä»¶
        files=("main.py" "telegram_main.py" "telegram_app.py" "requirements-telegram.txt" "zeabur.json")
        for file in "${files[@]}"; do
          if [[ -f "$file" ]]; then
            echo "âœ… $file å­˜åœ¨"
          else
            echo "âŒ $file ç¼ºå¤±"
          fi
        done
        
        echo ""
        echo "ğŸ“¦ æª¢æŸ¥ zeabur.json é…ç½®..."
        if [[ -f "zeabur.json" ]]; then
          cat zeabur.json
        fi
    
    - name: ğŸ“± éƒ¨ç½²å¾Œæé†’
      run: |
        echo ""
        echo "ğŸ¯ éƒ¨ç½²å®Œæˆå¾Œçš„ä¸‹ä¸€æ­¥ï¼š"
        echo ""
        echo "1ï¸âƒ£ å‰å¾€ Zeabur Dashboard æŸ¥çœ‹éƒ¨ç½²ç‹€æ…‹"
        echo "   https://dash.zeabur.com/"
        echo ""
        echo "2ï¸âƒ£ ç²å–éƒ¨ç½² URLï¼ˆé€šå¸¸æ ¼å¼å¦‚ä¸‹ï¼‰"
        echo "   https://namecard-app.zeabur.app"
        echo "   æˆ–"
        echo "   https://your-service-name.zeabur.app"
        echo ""
        echo "3ï¸âƒ£ è¨­ç½® Telegram Bot Webhook"
        echo "   curl -X POST \"https://api.telegram.org/bot\$TELEGRAM_BOT_TOKEN/setWebhook\" \\"
        echo "        -d \"url=https://your-app.zeabur.app/telegram-webhook\""
        echo ""
        echo "4ï¸âƒ£ æ¸¬è©¦æ‡‰ç”¨å¥åº·ç‹€æ…‹"
        echo "   curl https://your-app.zeabur.app/health"
        echo ""
        echo "5ï¸âƒ£ æ¸¬è©¦ Telegram Bot"
        echo "   åœ¨ Telegram ä¸­ç™¼é€ /start çµ¦æ‚¨çš„ Bot"